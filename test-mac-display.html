<!DOCTYPE html>
<html>
<head>
    <title>Test Mac Key Display</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; padding: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border: 1px solid #ddd; }
        .key { font-family: Monaco, monospace; background: #f0f0f0; padding: 2px 6px; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>Mac Key Display Test</h1>
    
    <h2>Test 1: Meta mapping to Command</h2>
    <button onclick="testMetaMapping()">Test Meta â†’ Command</button>
    <div id="metaResult"></div>
    
    <h2>Test 2: Meta mapping to Ctrl (default)</h2>
    <button onclick="testCtrlMapping()">Test Meta â†’ Ctrl</button>
    <div id="ctrlResult"></div>
    
    <script>
        function formatKeyForDisplay(key, isMac, macMMapping) {
            if (!isMac) return key;
            
            console.log(`ðŸŽ¨ formatKeyForDisplay: key="${key}", isMac=${isMac}, macMMapping=${macMMapping}`);
            
            // Convert to Mac-style display based on user preference
            let formatted;
            if (macMMapping === 'meta') {
                // User chose to map M- to Command, show meta+ as âŒ˜
                formatted = key
                    .replace(/ctrl\+/gi, 'âŒƒ ')  // Regular Ctrl keys
                    .replace(/meta\+/gi, 'âŒ˜ ')  // M- keys mapped to Command  
                    .replace(/alt\+/gi, 'âŒ¥ ')
                    .replace(/shift\+/gi, 'â‡§ ');
            } else {
                // User chose to map M- to Ctrl (default), show both ctrl+ and meta+ as âŒƒ
                formatted = key
                    .replace(/ctrl\+/gi, 'âŒƒ ')  // Regular Ctrl keys
                    .replace(/meta\+/gi, 'âŒƒ ')  // M- keys mapped to Ctrl  
                    .replace(/alt\+/gi, 'âŒ¥ ')
                    .replace(/shift\+/gi, 'â‡§ ');
            }
            
            // Clean up and format final result - remove trailing + and uppercase
            formatted = formatted
                .replace(/\s+$/, '')  // Remove trailing spaces
                .replace(/\+$/, '')   // Remove trailing +
                .trim();
            
            // Uppercase the final key only (not the symbols)
            formatted = formatted.replace(/([a-z])$/i, (match) => match.toUpperCase());
            
            console.log(`ðŸŽ¨ formatKeyForDisplay result: "${formatted}"`);
            return formatted;
        }
        
        function testMetaMapping() {
            const testKeys = [
                'meta+m',    // Should show âŒ˜ M
                'ctrl+b',    // Should show âŒƒ B  
                'meta+shift+m',  // Should show â‡§ âŒ˜ M
                'alt+g',     // Should show âŒ¥ G
            ];
            
            let html = '<div class="test-result"><h3>Meta â†’ Command Results:</h3>';
            testKeys.forEach(key => {
                const display = formatKeyForDisplay(key, true, 'meta');
                html += `<p><code>${key}</code> â†’ <span class="key">${display}</span></p>`;
            });
            html += '</div>';
            
            document.getElementById('metaResult').innerHTML = html;
        }
        
        function testCtrlMapping() {
            const testKeys = [
                'meta+m',    // Should show âŒƒ M
                'ctrl+b',    // Should show âŒƒ B  
                'meta+shift+m',  // Should show â‡§ âŒƒ M
                'alt+g',     // Should show âŒ¥ G
            ];
            
            let html = '<div class="test-result"><h3>Meta â†’ Ctrl Results:</h3>';
            testKeys.forEach(key => {
                const display = formatKeyForDisplay(key, true, 'ctrl');
                html += `<p><code>${key}</code> â†’ <span class="key">${display}</span></p>`;
            });
            html += '</div>';
            
            document.getElementById('ctrlResult').innerHTML = html;
        }
    </script>
</body>
</html>
